# Locked Models Directory

This directory contains **auto-generated TypeScript files** for locked AI models.

## üîí What are Locked Models?

When a model is "locked" in the Admin UI, the system generates a dedicated TypeScript file that contains:

- **Frozen Schema**: The input schema at the time of locking (never changes unless unlocked/re-locked)
- **Model Configuration**: Artifio.ai credit cost, estimated time, provider details
- **Payload Preparation**: Model-specific logic for preparing API requests
- **Validation**: Model-specific validation rules
- **Cost Calculation**: Credit cost calculation with multipliers
- **Execution**: Complete orchestration of the generation flow

## ‚ö†Ô∏è DO NOT EDIT THESE FILES MANUALLY

These files are auto-generated by the lock system. Manual edits will be overwritten.

### To make changes to a locked model:

1. Open the model in Admin UI
2. Click "Unlock Model"
3. Make your changes to the schema/config
4. Test the changes
5. Click "Lock Model" again to regenerate the file

## üîë Unique Identifier

**The unique identifier for each model is: `model_name + groups[0] + provider`**

This three-part key ensures uniqueness across the system:
- **model_name**: Human-readable model name (e.g., "FLUX.1 Kontext Max", "Google Veo 3.1 HQ")
- **groups[0]**: Primary functional group (e.g., "prompt_to_image", "image_editing", "prompt_to_video", "image_to_video")
- **provider**: API provider (e.g., "kie_ai", "runware", "lovable_ai_sync")

### Why This Matters

The same model name can appear in multiple groups with different capabilities:
- `FLUX.1 Kontext Max | image_editing | kie_ai` ‚Üí Different from `FLUX.1 Kontext Max | prompt_to_image | kie_ai`
- `Google Veo 3.1 HQ | image_to_video | kie_ai` ‚Üí Different from `Google Veo 3.1 HQ | prompt_to_video | kie_ai`
- `Remove Background | image_editing | runware` ‚Üí Different from `Remove Background | image_editing | kie_ai`

### Database Constraint

Uniqueness is enforced at the registry level through the file-based model system.
Each model is uniquely identified by its `recordId` and must have a unique combination of `modelName`, `group`, and `provider`.

## üìÅ File Naming Convention

Files are named using the pattern: `{Model_Name}_{group}_{provider}.ts` when disambiguation is needed:

- `Google_Veo_3_1_HQ.ts` - When model only exists in one group
- `FLUX_1_Kontext_Max_image_editing_kie_ai.ts` - When model appears in multiple groups
- `Seedance_V1_0_Pro_Fast_runware.ts` - When provider differentiates same name+group

## üéØ Why Locked Models?

**Production Stability**: Locked models are isolated from changes to the dynamic system. Changes to `executeGeneration.ts` or shared logic won't affect locked models.

**Transparency**: Open any locked file and see exactly what code runs for that model. No hidden logic.

**Model-Specific Logic**: Each model can have its own payload preparation, validation, and execution logic without affecting other models.

**Artifio.ai Metrics**: Credit cost and estimated time are frozen in each file, ensuring consistent billing.

**Git Audit Trail**: Every change to a locked model is tracked in Git via file diffs.

## üîÑ Lock Workflow

```
Admin UI (Unlocked)
    ‚Üì Design & Test
    ‚Üì Click "Lock Model"
    ‚Üì
Generated File (src/lib/models/locked/ModelName.ts)
    ‚Üì
Production (Isolated, Stable)
    ‚Üì Need Changes?
    ‚Üì Click "Unlock"
    ‚Üì
Admin UI (Unlocked) - Make Changes
    ‚Üì Test
    ‚Üì Click "Re-lock"
    ‚Üì
Updated File (Git diff shows changes)
```

## üìä Model Execution Flow

When a user generates content with a locked model:

1. `ModelRouter.ts` detects the model is locked
2. Dynamically imports the locked model file
3. Calls the `execute()` function from the locked file
4. The locked file handles everything: validation, cost calc, provider call, polling
5. Unlocked models still use the dynamic `executeGeneration()` flow

## üîß Developer Notes

- Each locked model is **completely independent**
- Shared code is limited to: provider clients, UI renderers, types
- Duplication is accepted as the cost of stability
- Focus on isolation over DRY principles
