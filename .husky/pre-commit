#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Run Prettier check
echo "ğŸ¨ Checking code formatting..."
npm run format:check 2>/dev/null || {
  echo ""
  echo "âš ï¸  Code formatting issues detected. Run 'npm run format' to fix."
  echo "   Continuing with other checks..."
}

# Run type check
echo "ğŸ” Running TypeScript check..."
npm run typecheck

# If type check fails, prevent commit
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Commit blocked: Fix TypeScript errors before committing"
  exit 1
fi

# Run ESLint
echo "ğŸ” Running ESLint..."
npm run lint

# If linting fails, prevent commit
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Commit blocked: Fix ESLint errors before committing"
  exit 1
fi

# Validate edge functions for deprecated patterns
echo "ğŸ” Validating edge functions..."
npm run validate:edge-functions
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Commit blocked: Fix deprecated patterns before committing"
  exit 1
fi

echo "âœ… All checks passed!"
